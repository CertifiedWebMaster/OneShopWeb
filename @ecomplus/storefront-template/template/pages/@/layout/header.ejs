<%
// load header options and contacts from content
const header = _.cms('header') || {}
const contacts = _.cms('contacts') || {}

// social networks handled by contacts
const networks = [
  'facebook',
  'youtube',
  'instagram',
  'twitter',
  'pinterest',
  'linkedin'
]

// store logo object
const logo = _.settings.logo
  ? { url: _.settings.logo, alt: _.settings.name }
  : _.store.logo

// list up to `max` main categories
let categories = []
if (header.max_categories) {
  categories = _.categories.filter(({ parent }) => !parent || !parent.slug)
    .slice(0, header.max_categories)
}
%>

<div id="overlay" class="fade"></div>

<div class="top-bar">
  <% if (header.marketing_stripe) { %>
    <% if (header.marketing_stripe.text) { %>
      <div class="d-none d-sm-block">
        <% if (header.marketing_stripe.link) { %>
          <a class="top-bar__countdown" href="<%= header.marketing_stripe.link %>">
            <%= header.marketing_stripe.text %>
          </a>
        <% } else { %>
          <div class="top-bar__countdown">
            <%= header.marketing_stripe.text %>
          </div>
        <% } %>
      </div>
    <% } %>
  <% } %>

  <div class="top-bar__nav d-none d-md-block">
    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <nav class="top-bar__page-links">
            <% if (header.contacts_stripe.pages) { %>
              <% header.contacts_stripe.pages.forEach(({ link, title }) => { %>
                <a href="<%= link %>"><%= title %></a>
              <% }) %>
            <% } %>
          </nav>
          <% if (header.contacts_stripe.phone_wpp) { %>
            <% if (contacts.whatsapp) { %>
              <a
                href="javascript:;"
                target="_blank"
                rel="noopener"
                class="whatsapp-link"
                data-tel="<%= contacts.whatsapp.replace(/\D/g, '') %>"
              >
                <i class="fab fa-whatsapp"></i>
                <%= contacts.whatsapp %>
              </a>
            <% } %>
            <% if (contacts.phone) { %>
              <a
                href="tel:+<%= contacts.phone.replace(/\D/g, '') %>"
                target="_blank"
                rel="noopener"
              >
                <i class="fas fa-phone"></i>
                <%= contacts.phone %>
              </a>
            <% } %>
          <% } %>
        </div>
        <% if (header.contacts_stripe.socials) { %>
          <div class="col-auto">
            <% networks.forEach(network => { %>
              <% if (contacts[network]) { %>
                <a href="<%= contacts[network] %>" target="_blank" rel="noopener">
                  <i class="fab fa-<%= network %>"></i>
                </a>
              <% } %>
            <% }) %>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<header class="header" id="header">
  <div class="header__container container-fluid">
    <div class="header__row row">
      <div class="col-auto p-0">
        <button
          class="btn header__toggler"
          type="button"
          onclick="toggleSidenav()"
          aria-label="Toggle side navigation"
        >
          <i class="header__toggler__icon fas fa-bars"></i>
          <% if (!categories.length) { %>
            <span class="d-none d-lg-inline">
              Menu
            </span>
          <% } %>
        </button>
      </div>

      <div class="col col-lg-auto">
        <a href="/">
          <% if (logo && logo.url) { %>
            <img
              id="logo"
              class="header__logo"
              src="<%= logo.url %>"
              alt="<%= logo.alt %>"
            >
          <% } else { %>
            <%= _.settings.name || _.store.name %>
          <% } %>
        </a>
      </div>

      <div class="order-lg-last col-auto p-0">
        <div
          class="header__buttons"
          role="group"
          aria-label="<%= _.dictionary('myAccount') %>"
        >
          <button
            class="d-lg-none btn btn-lg"
            id="mobile-search-btn"
            type="button"
            data-toggle="collapse"
            data-target="#search-bar"
            aria-expanded="true"
            aria-controls="search-bar"
            aria-controls="search-bar"
            aria-label="Search bar"
          >
            <i class="fas fa-search"></i>
          </button>

          <a
            id="user-button"
            class="btn btn-lg"
            role="button"
            href="/app/#/account/"
            data-toggle="tooltip"
            data-placement="bottom"
            title="<%= _.dictionary('myAccount') %>"
            aria-label="User button"
          >
            <!--
              `widgetUser` is rendered here:
              https://github.com/ecomclub/widget-user
            -->
            <i class="fas fa-user"></i>
          </a>
          <a
            id="cart-button"
            class="btn btn-lg"
            role="button"
            href="/app/#/cart"
            data-toggle="tooltip"
            data-placement="bottom"
            title="<%= _.dictionary('openCart') %>"
            aria-label="Cart button"
          >
            <!--
              `widgetMinicart` is rendered here:
              https://github.com/ecomclub/widget-minicart
            -->
            <i class="fas fa-shopping-bag"></i>
          </a>
        </div>
      </div>

      <div
        class="d-none d-lg-block col-12 col-lg<%= categories.length ? '-3' : '' %> collapse show"
        id="search-bar"
      >
        <form
          class="header__search mt-2 mt-md-3 mt-lg-0"
          id="search-form"
          action="/search"
          method="get"
        >
          <input
            type="search"
            name="term"
            placeholder="<%= _.dictionary('searchProducts') %>"
            aria-label="<%= _.dictionary('searchProducts') %>"
            class="header__search-input form-control"
            id="search-input"
          >
          <!--
            `widgetSearch` is rendered here:
            https://github.com/ecomclub/widget-search
          -->
          <button
            type="submit"
            class="header__search-btn"
            aria-label="<%= _.dictionary('searchProducts') %>"
          >
            <i class="fas fa-search"></i>
          </button>
        </form>
        <% if (_.settings.domain) { %>
          <script type="application/ld+json"><%-
            JSON.stringify({
              '@context': 'http://schema.org',
              '@type': 'WebSite',
              url: `https://${_.settings.domain}/`,
              potentialAction: {
                '@type': 'SearchAction',
                target: `https://${_.settings.domain}/search?term={search_term_string}`,
                'query-input': 'required name=search_term_string'
              }
            })
          %></script>
        <% } %>
      </div>

      <% if (categories.length) { %>
        <div class="col d-none d-lg-block">
          <nav class="header__nav">
            <% categories.forEach(({ slug, name }) => { %>
              <a href="javascript:;" onclick="toggleSidenav('<%= slug %>')">
                <%= ` ${name} ` %>
              </a>
            <% }) %>
          </nav>
        </div>
      <% } %>
    </div>
  </div>
</header>
