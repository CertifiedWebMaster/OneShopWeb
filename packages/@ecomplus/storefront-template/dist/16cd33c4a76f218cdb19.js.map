{"version":3,"sources":["webpack:///./template/js/lib/load-widgets.js"],"names":["window","ecomClient","EcomSearch","ecomPassport","ecomCart","emitter","emit","isCheckout","location","pathname","startsWith","isMobile","screen","width","widgetsLoadPromises","widgetsMsDelay","hostname","loadWidget","pkg","runImport","waitWidgetResolve","Promise","resolve","setTimeout","widget","_widgets","active","options","desktopOnly","enableCheckout","disablePages","then","exp","default","console","log","catch","error","finally","push","resource","document","body","dataset","getElementById","all","widgetProductCard"],"mappings":"mMAOAA,OAAOC,WAAaA,UACpBD,OAAOE,WAAaA,IACpBF,OAAOG,aAAeA,UACtBH,OAAOI,SAAWA,UAElBC,IAAQC,KAAK,cAEb,IAAMC,EAAaP,OAAOQ,SAASC,SAASC,WAAW,SACjDC,EAAWX,OAAOY,OAAOC,MAAQ,IACjCC,EAAsB,GACtBC,EAA8C,cAA7Bf,OAAOQ,SAASQ,SAA2B,GAAK,EAEjEC,EAAa,SAACC,EAAKC,GACvB,IAAMC,EAAoB,IAAIC,SAAQ,SAAAC,GACpCC,YAAW,WACT,IAAMC,EAASxB,OAAOyB,UAAYzB,OAAOyB,SAASP,GAClD,GAAIM,EAAQ,KACFE,EAA+DF,EAA/DE,OAAQC,EAAuDH,EAAvDG,QAASC,EAA8CJ,EAA9CI,YAAaC,EAAiCL,EAAjCK,eAAgBC,EAAiBN,EAAjBM,aACtD,GACEJ,KACEE,IAAgBjB,KACjBJ,EAAasB,GAAkBC,GAEhC,OAAOX,IACJY,MAAK,SAAAC,GACuB,mBAAhBA,EAAIC,SACbD,EAAIC,QAAQN,GAEdtB,IAAQC,KAAR,iBAAuBY,IACvBgB,QAAQC,IAAR,yBAA8BjB,OAE/BkB,MAAMF,QAAQG,OACdC,QAAQhB,GAIfA,MACCP,MAGLD,EAAoByB,KAAKnB,IAG3B,IAAKb,EAAY,KACPiC,EAAaC,SAASC,KAAKC,QAA3BH,SACJA,GAAYA,EAAS9B,WAAW,WAClCO,EACE,4BACA,kBAAM,iCAGCwB,SAASG,eAAe,WACjC3B,EACE,kCACA,kBAAM,iCAMZI,QAAQwB,IAAI/B,GAAqBiB,MAAK,WACpCd,EACE,iCACA,kBAAMI,QAAQC,QAAQ,CAAEW,QAASa,SAG9BvC,IACHU,EACE,yBACA,kBAAM,iCAERA,EACE,2BACA,kBAAM,iCAERA,EACE,6BACA,kBAAM,kCAIVI,QAAQwB,IAAI/B,GAAqBiB,MAAK,WACpCd,EACE,gCACA,kBAAM,iCAERA,EACE,6BACA,kBAAM,kCAERA,EACE,6BACA,kBAAM,0C","file":"16cd33c4a76f218cdb19.js","sourcesContent":["import emitter from './emitter'\nimport ecomClient from '@ecomplus/client'\nimport EcomSearch from '@ecomplus/search-engine'\nimport ecomPassport from '@ecomplus/passport-client'\nimport ecomCart from '@ecomplus/shopping-cart'\nimport widgetProductCard from '@ecomplus/widget-product-card'\n\nwindow.ecomClient = ecomClient\nwindow.EcomSearch = EcomSearch\nwindow.ecomPassport = ecomPassport\nwindow.ecomCart = ecomCart\n\nemitter.emit('ecom:ready')\n\nconst isCheckout = window.location.pathname.startsWith('/app/')\nconst isMobile = window.screen.width < 768\nconst widgetsLoadPromises = []\nconst widgetsMsDelay = window.location.hostname === 'localhost' ? 50 : 1\n\nconst loadWidget = (pkg, runImport) => {\n  const waitWidgetResolve = new Promise(resolve => {\n    setTimeout(() => {\n      const widget = window._widgets && window._widgets[pkg]\n      if (widget) {\n        const { active, options, desktopOnly, enableCheckout, disablePages } = widget\n        if (\n          active &&\n          (!desktopOnly || !isMobile) &&\n          (isCheckout ? enableCheckout : !disablePages)\n        ) {\n          return runImport()\n            .then(exp => {\n              if (typeof exp.default === 'function') {\n                exp.default(options)\n              }\n              emitter.emit(`widget:${pkg}`)\n              console.log(`Widget loaded: ${pkg}`)\n            })\n            .catch(console.error)\n            .finally(resolve)\n        }\n      }\n\n      resolve()\n    }, widgetsMsDelay)\n  })\n\n  widgetsLoadPromises.push(waitWidgetResolve)\n}\n\nif (!isCheckout) {\n  const { resource } = document.body.dataset\n  if (resource && resource.startsWith('product')) {\n    loadWidget(\n      '@ecomplus/widget-product',\n      () => import(/* webpackPrefetch: true */\n        '@ecomplus/widget-product')\n    )\n  } else if (document.getElementById('search')) {\n    loadWidget(\n      '@ecomplus/widget-search-engine',\n      () => import(/* webpackPrefetch: true */\n        '@ecomplus/widget-search-engine')\n    )\n  }\n}\n\nPromise.all(widgetsLoadPromises).then(() => {\n  loadWidget(\n    '@ecomplus/widget-product-card',\n    () => Promise.resolve({ default: widgetProductCard })\n  )\n\n  if (!isCheckout) {\n    loadWidget(\n      '@ecomplus/widget-user',\n      () => import('@ecomplus/widget-user')\n    )\n    loadWidget(\n      '@ecomplus/widget-search',\n      () => import('@ecomplus/widget-search')\n    )\n    loadWidget(\n      '@ecomplus/widget-minicart',\n      () => import('@ecomplus/widget-minicart')\n    )\n  }\n\n  Promise.all(widgetsLoadPromises).then(() => {\n    loadWidget(\n      '@ecomplus/widget-tag-manager',\n      () => import('@ecomplus/widget-tag-manager')\n    )\n    loadWidget(\n      '@ecomplus/widget-fb-pixel',\n      () => import('@ecomplus/widget-fb-pixel')\n    )\n    loadWidget(\n      '@ecomplus/widget-trustvox',\n      () => import('@ecomplus/widget-trustvox')\n    )\n  })\n})\n"],"sourceRoot":""}