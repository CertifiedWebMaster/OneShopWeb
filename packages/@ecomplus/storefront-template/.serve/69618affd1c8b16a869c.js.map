{"version":3,"sources":["webpack:///./template/js/lib/fetch-info.js"],"names":["window","_info","fetchInfoPromises","modulesToFetch","endpoint","Object","keys","utm","length","push","reqOptions","method","data","forEach","modInfo","promise","Promise","resolve","modules","url","then","result","Array","isArray","error","response","field","val","undefined","monthly_interest","max_number","value","emitter","emit","catch","err","console","finally","all"],"mappings":"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","file":"69618affd1c8b16a869c.js","sourcesContent":["import { modules } from '@ecomplus/client'\nimport emitter from './emitter'\nimport utm from './persist-utm'\n\nwindow._info = window._info || {}\nconst fetchInfoPromises = []\nconst modulesToFetch = [\n  { endpoint: 'list_payments' },\n  { endpoint: 'calculate_shipping' }\n]\nif (Object.keys(utm).length) {\n  modulesToFetch.push({\n    endpoint: 'apply_discount',\n    reqOptions: {\n      method: 'post',\n      data: { utm }\n    }\n  })\n}\n\nmodulesToFetch.forEach(({ endpoint, reqOptions }) => {\n  const modInfo = {}\n  window._info[endpoint] = modInfo\n\n  const promise = new Promise(resolve => {\n    modules({\n      url: `/${endpoint}.json`,\n      ...reqOptions\n    })\n\n      .then(({ data }) => {\n        const { result } = data\n        if (Array.isArray(result)) {\n          result.forEach(({ error, response }) => {\n            if (!error) {\n              let field, val\n\n              switch (endpoint) {\n                case 'calculate_shipping':\n                  field = 'free_shipping_from_value'\n                  val = response[field]\n                  if (typeof val === 'number' && (modInfo[field] === undefined || val < modInfo[field])) {\n                    modInfo[field] = val\n                  }\n                  break\n\n                case 'list_payments':\n                  field = 'installments_option'\n                  val = response[field]\n                  if (val && (!modInfo[field] ||\n                    val.monthly_interest < modInfo[field].monthly_interest ||\n                    val.max_number > modInfo[field].max_number)) {\n                    modInfo[field] = val\n                  }\n                  field = 'discount_option'\n                  val = response[field]\n                  if (val && (!modInfo[field] || val.value > modInfo[field].value)) {\n                    modInfo[field] = val\n                  }\n                  break\n\n                default:\n                  field = 'available_extra_discount'\n                  val = response[field]\n                  if (val && (!modInfo[field] || val.value > modInfo[field].value)) {\n                    modInfo[field] = val\n                  }\n              }\n            }\n          })\n        }\n        emitter.emit(`info:${endpoint}`, modInfo)\n      })\n\n      .catch(err => {\n        console.error(err)\n        emitter.emit(`info:${endpoint}`, err)\n      })\n\n      .finally(resolve)\n  })\n\n  fetchInfoPromises.push(promise)\n})\n\nPromise.all(fetchInfoPromises)\n  .then(() => emitter.emit('info', window._info))\n"],"sourceRoot":""}